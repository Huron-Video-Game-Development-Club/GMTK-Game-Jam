<!DOCTYPE html>
<html>
<head>
   <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
</head>
<body>

    <script>
    var width = 800;

    var height = 800;
        
    var config = {
        type: Phaser.AUTO,
        width: width,
        height: height,
        pixelArt: true,
        physics: {
            /*default: 'arcade',
            arcade: {
                gravity: { y: 0 }
            }*/
            default: 'matter',
            matter:{
                gravity:{
                    x: 0,
                    y: 0
                },
                debug:{
                    showBody: true,
                    showStaticBody: true
                }
            }
            
        },
        scale: {
    parent: 'game-container',
    mode: Phaser.Scale.HEIGHT_CONTROLS_WIDTH,
    autoRound: true,
    autoCenter: Phaser.DOM.CENTER_BOTH,
  },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);

    function loadSheet(game, name, dataURI, width, height){
        console.log("NEW");
        var img = new Image();
        img.onload = function(){
            game.textures.addSpriteSheet(name, img, {frameWidth: width, frameHeight: height});
        }
        img.src = dataURI;
    }

    function preload(){
        
        let uri1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAYCAYAAAC8/X7cAAAAAXNSR0IArs4c6QAAARxJREFUWEftl8sNAjEMRHePNMKZUiiAPqiBPiiAUjjTCEdQkCKZ7Nozjs1nBVxxZvIyJDbjsPDPuPD9D18JcNrsbuVgt+cj3B8smEvIY+BNuGrXdQjCDeA18AC02gyEC6DH4GcAtMNBKdAJ9BowCSBtC4ICiBggAFZbe5UgQNTAAvBoaymYABkGGoDU3l8vj7LDao0Cm/QGFSDLwOoj9bsWAAHJ3jAL0J58xKAFYFINAWQb9ADA35EYMyYJMAAeA1mbpS1fpCeAVxj8AZS460V+awJlL9GU2+k0/Q6g8bceqBzJ56CqDhrdYR8oQhED1MgQcAoAMw6gjWjPKVrXBSBP3DJg66xeENWHd0Az6P1nxq5j6+A0yjStT9bcAc3f6Bk+Ifp6AAAAAElFTkSuQmCC";
        loadSheet(this, 'idle', uri1, 24, 24);

        let uri2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAAYCAYAAAAF6fiUAAAAAXNSR0IArs4c6QAAAb5JREFUaEPtmMFVxDAMRNkjjeyZUiiAPqhh+6AASuFMIxzhhff8njGRZsaSdhMIR+wdjefLiZ3T3fF30wRON61uFH99ePpchh7fXjbpD2Wm+J9aoFIAmR3Hm3b7fwWELfmXAVQGNGpXQNiafwlAdUD/UX8zAKzwM3dBJeBZ/zSA2QLMOwBpZ0BANSLvGqTt+acARAogAKx25FTE1piBwGpb/iGAaAEPgKI9uwuUGioARdvy7wLIKGAB6LWfP96/p13uz2jDSHeDPfg3AVQGNAYzAkBAmE7di/9VAJUBMV0ZBbAn/78AVAfE6MPnkPOZgtGPAGb0Ff9TAJQC/dws896JKKvG2mMuS7v3/wNARYFrAtij/wOAsZ3/5A5Y1hrtUu8EFNXuWVh1ojVG3fR3gHpEXOavLarpeGNrzZsdELrHeP57L1Yu8B7ABsQE3xbTjLG/GUNlftfXYAAzmt77zHtkedrUTRhtR8U80xVM1zEnMQQajSufUcYM2HVeFcBMJ48hLBoscBQwGp+FrKwTPoKsMzdLmFlExRzkD40rnpSmGHWpTxHe9vIuRcoiMueiDkTjmV6QFvwcjQSO8VgCX5sy1ChabDngAAAAAElFTkSuQmCC";
        loadSheet(this, 'run', uri2, 24, 24);
        
        this.load.spritesheet('idle', 'https://google.com/idledsfndsl', {frameWidth: 24, frameHeight: 24}); 

        //this.load.image("rock", "/rock.png");
        let uri3 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHFJREFUSEtjrKvr/89AQ8AIsqCpqZCRFnaAzKafBehBRQ1fofhg0FlAjIMo8gHJFpCaiga3BYQyH7EpDGc+GLUAlmCoFkTIQYocP6MWEMybVC2useVs+luAKzVgCwt0tUT5YFBbgMuX9KmTCaY3ChQAAE8nCRgzzg/uAAAAAElFTkSuQmCC";
        this.textures.addBase64("rock", uri3);

        this.load.image("dice", "/blue.png");

        
    }

    var player;
    var keys;
    var idleAnim;
    var runAnim;
    var platforms;
    var dice;

    function getForceVector(p1, p2, magnitude){
        let d = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
        return {x: ((p2.x - p1.x)/d) * magnitude, y: ((p2.y - p1.y)/d) * magnitude};
    }
        

    const FRICTION = 0;
    const BOUNCE = 1;
    const FORCE = 10;


    function create(){
        keys = this.input.keyboard.createCursorKeys();
        idleAnim = this.anims.create({
            key: 'idle',
            frames: this.anims.generateFrameNumbers('idle', {start: 0, end: 3}),
            frameRate: 4,
            repeat: -1
        });

        runAnim = this.anims.create({
            key: 'run',
            frames: this.anims.generateFrameNumbers('run', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });


        player = this.matter.add.sprite(100, 100, 'run');
        player.setScale(2);
        player.isMoving = {x: false, y: false};
        player.setFixedRotation();
        player.setMass(1);
        player.name = "player";
        
        
     //   player.setCollideWorldBounds(true);
       /* platforms = this.physics.add.staticGroup();

        //  Here we create the ground.
        //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
        platforms.create(400, 568, 'rock').refreshBody();

        //  Now let's create some ledges
        platforms.create(600, 400, 'rock');
        platforms.create(50, 250, 'rock');
    
        player.isMoving = {x: false, y: false};
        player.setMass(1);
       // player.play("run");

       dice = this.physics.add.sprite(400, 400, "dice");
       dice.setScale(2);

        dice.setDrag(10);
       dice.setMass(1);
       //dice.setImmovable(true);
       dice.setAngularVelocity(30);
       dice.setFriction(1, 1);
       dice.setCollideWorldBounds(true);
       dice.setBounce(1, 1);
*/
       var dice2 = this.matter.add.sprite(400, 400, "dice");
       dice2.setRotation(Math.PI/4);
       dice2.setMass(100000);
       dice2.setFriction(0);
       dice2.setFrictionAir(FRICTION);
       dice2.setBounce(BOUNCE);

       dice2.setOnCollideActive((data)=>{
            if (keys.space.isDown){
                var newVelocity = getForceVector(player.body.position, dice2.body.position, FORCE);
                console.log(newVelocity);
                dice2.setVelocity(newVelocity.x, newVelocity.y);
                console.log("DID IT");
                dice2.setAngularVelocity(0.2);
            }
       });

       var rightEdge = this.matter.add.rectangle(800, 0, 100, 1600, {isStatic: true});
       var leftEdge = this.matter.add.rectangle(0, 0, 100, 1600, {isStatic: true});
       var upEdge = this.matter.add.rectangle(0, 0, 2000, 100, {isStatic: true});
       var downEdge = this.matter.add.rectangle(0, 800, 2000, 100, {isStatic: true});
      // this.physics.add.collider(player, dice);
      // this.physics.add.collider(player, platforms);
      



    }

    const SPEED = 3;

    function update(){
        if (keys.left.isDown){
            player.setVelocityX(-SPEED);
            player.setFlipX(false);
            player.isMoving.x = true;
        }
        else if (keys.right.isDown){
            player.setVelocityX(SPEED);
            player.setFlipX(true);
            player.isMoving.x = true;
        }
        else{
            player.isMoving.x = false;
            player.setVelocityX(0);
        }

        if (keys.up.isDown){
            player.setVelocityY(-SPEED);
            player.isMoving.y = true;
        }
        else if (keys.down.isDown){
            player.setVelocityY(SPEED);
            player.isMoving.y = true;
        }
        else{
            player.isMoving.y = false;
            player.setVelocityY(0);
        }

        if (!player.isMoving.x && !player.isMoving.y){
            player.play('idle', true);
            player.setVelocityX(0);
            player.setVelocityY(0);
        }
        else{
            player.play("run", true);
        }
       // player.play("run");
       
       
    }
    </script>

</body>
</html>