<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin&family=Roboto:wght@500&display=swap" rel="stylesheet">
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
   
    <style>
        *{
            font-family: "Roboto", sans-serif;
            font-size: 16px;
        }

        .green{
            color: white;
            background-color: #1E555C;
        }

        .pilled{
            border-radius: 20px;
            padding-left: 5px;
            padding: 10px;
            padding-right: 5px;
        }
    </style>
</head>
<body style="padding: 0px; margin: 0px;">
    <div id="overlay"></div>
    <script>
    var width = 800;

    var height = 800;
        
    var config = {
        type: Phaser.AUTO,
        width: width,
        height: height,
        pixelArt: true,
        physics: {
            /*default: 'arcade',
            arcade: {
                gravity: { y: 0 }
            }*/
            default: 'matter',
            matter:{
                gravity:{
                    x: 0,
                    y: 0
                },
                debug:{
                    showBody: true,
                    showStaticBody: true
                }
            }
            
        },
        scale: {
    parent: 'game-container',
    mode: Phaser.Scale.HEIGHT_CONTROLS_WIDTH,
    autoRound: true,
    autoCenter: Phaser.DOM.CENTER_BOTH,
  },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    //game and UI overlay
    var game = new Phaser.Game(config);
    var overlay;
    window.onload = function(){
        var canvas = document.querySelector("canvas");
        let dim = canvas.getBoundingClientRect()

        var overlay = document.getElementById("overlay");
        overlay.style.position = "absolute";
        overlay.style.left = dim.x + "px";
        overlay.style.top = dim.y + "px";
        overlay.style.height = dim.height + "px";
        overlay.style.width = dim.width + "px";
        //Arrow Keys to Move instruction
        overlay.innerHTML += `<div id="instr_one"><div style="position: absolute; top: 200px; left: 300px;" class="pilled green">
            <t style="padding: 0px;">Arrow Keys to Move</t>
            </div>
            <div style="position: absolute; top: 250px; left: 300px;" class="pilled green">
            <t style="padding: 0px;">Space to Dash</t>
            </div>
            </div>
            `
        overlay.innerHTML += `<div id="instr_two" style="position: absolute; display: none; top: 200px; left: 200px;" class="pilled green">
            <t style="padding: 0px;">Spacebar when near the die to kick it</t>
            </div>

        <div id="instr_three" style="position: absolute; display: none; top: 200px; left: 200px;" class="pilled green">
            <t style="padding: 0px;">Use the power of the die to CRUSH THINE ENEMIES! Good luck...</t>
            </div>
        <div id="instr_three-btn" style="position: absolute; display: none; top: 400px; left: 200px; border-radius: 5px;" class="pilled green">
            <t style="padding: 0px;">Hold Space to Start</t>
            </div>
            `
        overlay.innerHTML += `
            <div id="gameData" style="display: none;">
                <div style="position: absolute; top: 30px; left: 10px; border-radius: 5px;" class="pilled green">
                    <t style="padding: 0px;" id="kickCount">Kicks remaining: </t>
                </div>
                <div style="position: absolute; top: 70px; left: 10px; border-radius: 5px;" class="pilled green">
                    <t style="padding: 0px;" id="enemyCount">Enemies remaining: </t>
                </div>
            </div>

        `
        
       // overlay.style.backgroundColor ="blue";
    }

    //game constants
    //Experiment with these!
    const FRICTION = 0.005; //0-1 where 0 is no friction
    const BOUNCE = 0.9; //0-1 where 1 means 100% of kinetic energy is retained on bounce by dice
    const FORCE = 10; //Initial force of dice kick
    var SPEED = 3; //Player speed

    //global variables for game objects and other stuff
    var player;
    var keys;
    var idleAnim;
    var runAnim;
    var platforms;
    var dice;
    var daves = [];
    var bobs = [];
    var slimes = [];
    var lavas = [];
    var stage = "tutorialPt1";
    var stageCompleted = false;
    var enemyCount = 1;
    var kickCount = 2;
    var arrow;
    var interactable = true;
    var hoverableRollAnims = [];
    var explosion;
    var explodeAnim;
    var freeOnes = [true, true, true, true, true, true, true, true, true, true];


    var isAlive = true;

    //helper method to load a spritesheet from Data URI
    function loadSheet(game, name, dataURI, width, height){
       // console.log("NEW");
        var img = new Image();
        img.onload = function(){
            game.textures.addSpriteSheet(name, img, {frameWidth: width, frameHeight: height});
        }
        img.src = dataURI;
    }

    //gets the normalized vector from p1 to p2 times given magnitude
    function getForceVector(p1, p2, magnitude){
        let d = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
        return {x: ((p2.x - p1.x)/d) * magnitude, y: ((p2.y - p1.y)/d) * magnitude};
    }

    //returns true or false as to whether a given matter sprite was involved in the collision data
    function wasInvolved(sprite, data){
        return (data.bodyA.name == sprite.body.name || data.bodyB.name == sprite.body.name);
    }

    function wasInvolvedShape(shape, data){
        return (data.bodyA.name == shape.name || data.bodyB.name ==  shape.name);
    }

    //updates the kick and enemy counts and the UI based on the values given
    function updateKickAndEnemyCounts(newKicks, newEnemies) {
        enemyCount = newEnemies;
        kickCount = newKicks;
        document.getElementById("enemyCount").innerHTML = "Enemies remaining: " + enemyCount;
        document.getElementById("kickCount").innerHTML = "Kicks remaining: " + kickCount;  
    }

    function resetDice() {
        dice.setScale(1);
        dice.detector.setScale(2.5);
        if (dice.fiery){
            try{
                explosion.destroy();
                clearInterval(explodeAnim);
            }
            catch{

            }
        }
        setTimeout(function(){
            for (slime of slimes) {
                slime.destroy();
            }
            for (lava of lavas) {
                lava.destroy();
            }
            slimes = [];
            lavas = [];
        }, 1000);
        dice.fiery = false;
        clearInterval(dice.slimeAnim);
        clearInterval(dice.lavaAnim);
    }
        
    //loads the stage with the given name
    function loadStage(name, game){
        switch(name){
            case "tutorialPt2":
                document.getElementById("instr_one").style.display = "none";
                document.getElementById("instr_two").style.display = "block";
                break;
            case "tutorialPt3":
                document.getElementById("instr_two").style.display = "none";
                document.getElementById("instr_three").style.display = "block";
                document.getElementById("instr_three-btn").style.display = "block";
                break;
            case "one":
                resetDice();
                document.getElementById("instr_three").style.display = "none";
                document.getElementById("instr_three-btn").style.display = "none";
                player.setPosition(400, 600);
                dice.setPosition(400, 100);
                dice.setRotation(0);
                dice.detector.setPosition(400, 100);
                dice.setVelocity(0, 0);
                dice.setAngularVelocity(0);
                createBob(game, 400 ,300);
                updateKickAndEnemyCounts(200, 1);
                document.getElementById("gameData").style.display = "block";
                break;
            case "two":
                resetDice()
                player.setPosition(400, 600);
                dice.setPosition(400, 100);
                dice.setRotation(0);
                dice.detector.setPosition(400, 100);
                dice.setVelocity(0, 0);
                dice.setAngularVelocity(0);
                createBob(game, 400 ,300);
                updateKickAndEnemyCounts(200, 1);
                document.getElementById("gameData").style.display = "block";
        }
    }

    //transitions to given stage
    function stageTransition(name, game=null, delay=1500){
        stageCompleted = true;
        window.setTimeout(function(){
            stage = name;
            stageCompleted = false;
            loadStage(name, game);
        }, delay);
    }

    function getRandomUnitVector(){
        let x = Math.random();
        let y = Math.sqrt(1 - x * x);
        return {x: x, y: y};
    }

    function getSpeed(sprite){
        return Math.sqrt(sprite.body.velocity.x * sprite.body.velocity.x + sprite.body.velocity.y * sprite.body.velocity.y);
    }

    function addBullet(game, x, y, speed, trajectory){

    }

    function createBob(game, x, y, hp=2){
        var bob = game.matter.add.sprite(x, y, "d1");
        bob.setScale(2);
        bob.hp = hp;
        bob.setSensor(true);
        bob.play("d1_run");
        bob.body.name = "bob";
        bob.chase = true;
        bob.index = bobs.length;
        bob.hoverIndex = -1;
        bob.state =  "premove";
        bob.roll = 0;
        bob.flag = true;
        bob.shootFlag = true;
        var trajectory = 0;
        bob.update = function(){
            if (player.body.position.x >= bob.body.position.x){
                bob.setFlipX(false);
            }
            else{
                bob.setFlipX(true)
            }
            if (bob.state == "premove" && bob.flag){
                bob.flag = false;
                trajectory = getForceVector(bob.body.position, player.body.position, 1);
                setTimeout(function(){
                    bob.state = "move";
                    bob.flag = true;
                }, 500);
            }
            else if (bob.state == "move"){
                bob.setVelocity(trajectory.x, trajectory.y);
                if (bob.flag){
                    setTimeout(function(){
                        bob.state = "roll";
                        bob.flag = true;
                    }, 1000);
                }   
            }
            else if (bob.state == "roll" && bob.flag){
                bob.setVelocity(0, 0);
                bob.flag = false;
                bob.roll = Math.floor(Math.random() * 6) + 1;

                if (bob.hoverIndex == -1){
                    for (var y = 0; y < freeOnes.length; y++){
                        if (freeOnes[y]){
                            hoverableRollAnims[y].setPosition(bob.body.position.x, bob.body.position.y - 50);
                            hoverableRollAnims[y].visible = true;
                            freeOnes[y] = false;
                            bob.hoverIndex = y;
                            break;
                        }
                    }
                }
                else{
                    hoverableRollAnims[bob.hoverIndex].setPosition(bob.body.position.x, bob.body.position.y - 50);
                    hoverableRollAnims[bob.hoverIndex].visible = true;
                }
                
                

                
                setTimeout(function(){
                    if (bob.hoverIndex != -1){
                        hoverableRollAnims[bob.hoverIndex].visible = false;
                    }
                    bob.state = "shoot";
                    bob.flag = true;
                }, 1000)
                //play roll animation
            }
            else if (bob.state == "shoot" && bob.flag && bob.shootFlag){
                bob.flag = false;
                bob.play("d" + bob.roll + "_run");
                console.log(bob.roll);
                if (bob.shootFlag){
                    for (var a = 0; a < bob.roll; a++){
                        setTimeout(function(){
                            var vec = getForceVector(bob.body.position, player.body.position, 1);
                            createBullet(game, bob.body.position.x + vec.x * 5, bob.body.position.y + vec.y * 5, vec, 7)
                        }, 200 * (a + 1));
                    }
                    bob.shootFlag = false;
                }
                
                setTimeout(function(){
                    bob.state = "premove";
                    bob.flag = true;
                    bob.shootFlag = true;
                }, 1000);
            }
        }
        bobs.push(bob);
        bob.setOnCollideActive((data)=>{
          //  console.log("collision");
            if (wasInvolved(player, data)){
                player.visible = false;
                isAlive = false;
            }
            else if (wasInvolved(dice, data)){
                
                
            }
        });

        bob.setOnCollideWith(dice, (data)=>{
            let base = getForceVector(dice.body.position, bob.body.position, 1);
            dice.setVelocity(-base.x * getSpeed(dice), -base.y * getSpeed(dice));
            //dice.activate();
            bob.hp -= 1;
            var flashEff =  setInterval(function(){
                if (flash){
                    flash = false;
                    bob.clearTint();
                }
                else{
                    flash = true;
                    bob.setTintFill(0xFFFFFF);
                }
            }, 200);
            setTimeout(function(){
                clearInterval(flashEff);
                bob.clearTint();
            }, 1000);
            var flash = true;
            if (bob.hp <= 0){
                bob.destroy();
                bobs[bob.index] = 0;
                freeOnes[bob.hoverIndex] = true;
                hoverableRollAnims[bob.hoverIndex].visible = false;
                updateKickAndEnemyCounts(kickCount, enemyCount - 1);
            }
        })
        return bob;

    }

    //creates a new dave enemy and appends it to daves
    function createDave(game, x, y){
        dave = game.matter.add.sprite(250, 250, "dave_idle");
        dave.setScale(2);
        dave.setSensor(true);
        dave.play("dave_idle");
        dave.body.name = "dave";
        dave.moveRight = true;
        dave.index = daves.length;
        dave.update = function(){

            if (dave.body.position.x > 600 && dave.moveRight){
                dave.moveRight = false;
            }
            else if (dave.body.position.x < 100 && !dave.moveRight){
                dave.moveRight = true;
            }
            
            if (dave.moveRight){
                dave.setVelocityX(2);
            }
            else{
                dave.setVelocityX(-2);
            }
        }
        daves.push(dave);
        dave.setOnCollideActive((data)=>{
            //console.log("collision");
            if (wasInvolved(player, data)){
                player.visible = false;
                isAlive = false;
            }
            else if (wasInvolved(dice, data)){
                daves[dave.index] = 0;
                let base = getForceVector(dice.body.position, dave.body.position, 1);
                dice.setVelocity(-base.x * getSpeed(dice), -base.y * getSpeed(dice));
               // dice.activate();
                dave.destroy();
                updateKickAndEnemyCounts(kickCount, enemyCount - 1);
            }
        });
        return dave;
    }


    function createExplosion(game, x, y) {
        explosion = game.matter.add.sprite(x, y, "dice");
        explosion.visible = false;
        explosion.setSensor(true);
        var explosionScale = 1;
        dice.setVelocity(dice.body.velocity.x * 4, dice.body.velocity.y * 4);
        dice.fiery = true;
        explodeAnim = setInterval(function(){
            explosionScale += 0.04;
            explosion.setScale(explosionScale)
        }, 20);
        setTimeout(function(){
            clearInterval(explodeAnim);
            explosion.destroy();
        }, 1000);
        explosion.setOnCollideActive((data)=>{
            if (wasInvolved(player, data)){
                player.visible = false;
                isAlive = false;
               // console.log("WE GOT EM");
            }
        });
    }

    function createSlime(game, x, y){
        var slime = game.matter.add.sprite(x, y, "dice");
        slime.visible = false;
        slime.setSensor(true);
        slime.setOnCollideActive((data)=>{
            if (wasInvolved(player, data)){
                player.inSlime = true;
               // console.log("WE GOT EM");
            }
        });

        slime.setOnCollideEnd((data)=>{
            if (wasInvolved(player, data)){
                player.inSlime = false;
            }
        });

        slimes.push(slime);
    }

    function createBullet(game, x, y, trajectory, speed){
        var bullet = game.matter.add.sprite(x, y, "bullet");
        bullet.setScale(2);
        bullet.setSensor(true);
        var b = Math.sqrt(trajectory.x * trajectory.x + trajectory.y * trajectory.y)
        bullet.setVelocity(trajectory.x * speed / b, trajectory.y * speed/b);
        bullet.setOnCollideWith(player, (data)=>{
            player.visible = false;
            isAlive = false;
        });
        var z = setTimeout(() => {
            bullet.destroy();
        }, 5000);
        bullet.setOnCollideWith(dice, (data)=>{
            clearTimeout(z);
            bullet.destroy();
        });
    }

    // Creates lava object when die collides with something
    function createLava(game, x, y) {
        var lava = game.matter.add.sprite(x, y, "dice");
        
        // No visuals because no sprite yet
        // Delete in final version
        lava.setScale(2, 2);
        lava.visible = false;
        
        lava.setSensor(true);
        lava.setOnCollideActive((data)=>{
            if (wasInvolved(player, data)){
                player.inLava = true;
            }
        });

        lava.setOnCollideEnd((data) => {
            if (wasInvolved(player, data)){
                player.inLava = false;
            }
        });

        lavas.push(lava);
    } // createLava()

    function preload(){
        
        let uri1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAYCAYAAAC8/X7cAAAAAXNSR0IArs4c6QAAARxJREFUWEftl8sNAjEMRHePNMKZUiiAPqiBPiiAUjjTCEdQkCKZ7Nozjs1nBVxxZvIyJDbjsPDPuPD9D18JcNrsbuVgt+cj3B8smEvIY+BNuGrXdQjCDeA18AC02gyEC6DH4GcAtMNBKdAJ9BowCSBtC4ICiBggAFZbe5UgQNTAAvBoaymYABkGGoDU3l8vj7LDao0Cm/QGFSDLwOoj9bsWAAHJ3jAL0J58xKAFYFINAWQb9ADA35EYMyYJMAAeA1mbpS1fpCeAVxj8AZS460V+awJlL9GU2+k0/Q6g8bceqBzJ56CqDhrdYR8oQhED1MgQcAoAMw6gjWjPKVrXBSBP3DJg66xeENWHd0Az6P1nxq5j6+A0yjStT9bcAc3f6Bk+Ifp6AAAAAElFTkSuQmCC";
        loadSheet(this, 'idle', uri1, 24, 24);

        //let uri2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAAYCAYAAAAF6fiUAAAAAXNSR0IArs4c6QAAAb5JREFUaEPtmMFVxDAMRNkjjeyZUiiAPqhh+6AASuFMIxzhhff8njGRZsaSdhMIR+wdjefLiZ3T3fF30wRON61uFH99ePpchh7fXjbpD2Wm+J9aoFIAmR3Hm3b7fwWELfmXAVQGNGpXQNiafwlAdUD/UX8zAKzwM3dBJeBZ/zSA2QLMOwBpZ0BANSLvGqTt+acARAogAKx25FTE1piBwGpb/iGAaAEPgKI9uwuUGioARdvy7wLIKGAB6LWfP96/p13uz2jDSHeDPfg3AVQGNAYzAkBAmE7di/9VAJUBMV0ZBbAn/78AVAfE6MPnkPOZgtGPAGb0Ff9TAJQC/dws896JKKvG2mMuS7v3/wNARYFrAtij/wOAsZ3/5A5Y1hrtUu8EFNXuWVh1ojVG3fR3gHpEXOavLarpeGNrzZsdELrHeP57L1Yu8B7ABsQE3xbTjLG/GUNlftfXYAAzmt77zHtkedrUTRhtR8U80xVM1zEnMQQajSufUcYM2HVeFcBMJ48hLBoscBQwGp+FrKwTPoKsMzdLmFlExRzkD40rnpSmGHWpTxHe9vIuRcoiMueiDkTjmV6QFvwcjQSO8VgCX5sy1ChabDngAAAAAElFTkSuQmCC";
        let uri2 = "data:image/png;base64,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"
        loadSheet(this, 'run', uri2, 27, 28);
        
        this.load.spritesheet('idle', 'https://google.com/idledsfndsl', {frameWidth: 24, frameHeight: 24}); 

        //this.load.image("rock", "/rock.png");
        let uri3 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHFJREFUSEtjrKvr/89AQ8AIsqCpqZCRFnaAzKafBehBRQ1fofhg0FlAjIMo8gHJFpCaiga3BYQyH7EpDGc+GLUAlmCoFkTIQYocP6MWEMybVC2useVs+luAKzVgCwt0tUT5YFBbgMuX9KmTCaY3ChQAAE8nCRgzzg/uAAAAAElFTkSuQmCC";
        this.textures.addBase64("rock", uri3);

        let uri4 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAAAXNSR0IArs4c6QAAAN9JREFUeF7t1LEJg1AYRlGdQXCKVBnAER3KcQRniKSPiXC7cF7/msv5v/HxXF+Dd1lgfAea5kWiDwWOfRsE+kJDoB93I5BAbVoJIoigVoCg1s8GEURQK0BQ62eDCCKoFSCo9bNBBBHUChDU+tkggghqBQhq/WwQQQS1AgS1fjaIIIJaAYJaPxtEEEGtAEGtnw0iiKBWgKDWzwYRRFArQFDrZ4MIIqgVIKj1s0EEEdQKENT62SCCCGoFCGr9bBBBBLUCBLV+NogggloBglo/G0QQQa0AQa2fDborqHX+798n0vBccM0SKBcAAAAASUVORK5CYII="
        this.textures.addBase64("dice", uri4);

        //this.load.spritesheet("dave_idle", "/dave.png", {frameWidth: 24, frameHeight: 24});
        let uri5 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAAYCAYAAAAF6fiUAAAAAXNSR0IArs4c6QAAAcxJREFUaEPtmeGNwzAIhdOJboNuk6myTTe4iVr5JFeci+GBwc6d0l+VXD3w9wDXyW27PksJ3JZGTwz+eHw/Ufn7/WsZh2WBUTjW31nAt9orjGAN8GzCknyWvkfXY4InTo/PLwM8wpYN/AX9sp8erIz83wZEiFczuA1k65fYUTFm5p9iAFdFUXB6JkfqZxtA+VwGMKf8dAMiq4er0Gx9afzs+/5GfBzHB+66TtdaAzLz/+mAzAAz9P+1AWgFFQi9KpIMjtDXTOaqvLZCWWs7w9IBo/mrHTAaAIXTGkgB1e+zxsSpDCib1yqIg0c3oY24UX3NZOtt2mLAKB+1A6zJrzqEkXOgHTU9460GeBjVGFMM0Cq0B0LqDPS2SkdoD5R2BmTmD90DogBxowgBpI04CraNgegjBvRMQPSl/NVnQaMBJDh0fmptjELiQGl7kA737PynGuCtIgv8CgztNqs2qkuNk2J8PI6ODsBVdu9fEVep3O0VffSt/fvickO0I/M3vQ84A6ACDYEkdUJv3Fl0tYNZGqk0jvhGzFNBmYCs2hYTrPAt2tSMNo76StJqgmcjaAyPtna4R6yP5K8aYGm1swKKgJylARmQFfzS3bYX7jPIKJDp3YMAAAAASUVORK5CYII="
        loadSheet(this, 'dave_idle', uri5, 24, 24);

        let uri6 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADFJREFUKFNjZCAAGJHlNxjE/AfxAy4sgYvDGTBJmAaYIrACdElkRYy4JGGKqKCAkDcB/2USujWLhUMAAAAASUVORK5CYII="
        this.textures.addBase64("arrow", uri6);

        let d1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAVCAYAAAD/wUjgAAAAAXNSR0IArs4c6QAAAVdJREFUWEftWNERgzAI1Wl0gi7RebtEJ9Bp2sPr61EMASXRqxe/PC+Qx+MJIX1X8BmG22uLu3l+9lvWe9dGcHwBRZwQULKfpocX87JuHO+dJOVsHAsh0WD22IM5TsoeP1F7iaPfA0I6uZKPRsgnu1BaI6QRkq77hymENqJH60AAUrsOeXFkfxmvk1ww/+ajOiHWwcSjkBKkenG0otqK6slF1SvV2kXVi+Nyv0yuo+VIKdp2rXmIF0W8AxyGuxIKgU8MiNTq+X5W6yf7IsOdBYSCRsCpCZfbl5iYeYLk8AcFcaL4xL0a/yWrACu/a3cZWuD8u1QHl7KW3QgOvp+VmJ8LGk8w1qWOFrj8JTxKkWusYCSxXG3yvGMqRMpMYzWX3VQt4UBkUfOoLIIjtZ+VmKRC4Eg7RVrZ9QauVX0NtBWM1VqRsBy+FSEaq9EgPWBlceY2KMy1cbwBr0ygNMzWL1UAAAAASUVORK5CYII=";
        let d2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAVCAYAAAD/wUjgAAAAAXNSR0IArs4c6QAAAXFJREFUWEftWNsNwjAMpNOUCViCeVmCCco0oCCMrsauH3EpIPpVRYl9d3acOMOu8BvHwzVi7nI5D5H53rk9OJ6Aeow0oG39NJ28mO/z9vvjjouyNY67IL1kMutJORQlY6d3PccxZEBwI79ko1yQFrH2ebcPRbha1CyOmSBZI0jm222UCxKqqlBYq0XN4ijfMlkg1Vsmi+MvyEM5qmV/QbYWhBfdtU4Za8toOEIZUkHm0228XRAeuUyGVIiq4QgJUkFmbRuRSyFiKS2qVj+EEaV/AkPNXcWxSzapQWy3ZfSn3Z6xHypp7iwgjTQRljpcXO+98kvNIUZc8qcJhR33S/vPVSUnfFx7y9CI4zjPDk6E0p5nkzTuwYH+rMDMHmg8ZKxHHY043xKeTOFzLDJShmidOYotZgjWAT7ZG12pluApwgtqT3SXsoxwSP6swIgZoqlq7dslINZFKRJdDw7Nn/Qit5ghmqre6EaIR0FbZCp83wCAzLg03NfrIwAAAABJRU5ErkJggg==";
        let d3 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAVCAYAAAD/wUjgAAAAAXNSR0IArs4c6QAAAYpJREFUWEfdmOERgjAMhWEamMAlnNclnACm0St38R4hadI2RZFfnte+fnlNSsM4BD7TdHuVyK3rcywZ7x3bwvEBahFJoGn+sjy8zNu4eb4P3JRvc2yGtAZTM5+cQ1NqdFrnc46xBoKL/JNGuCFpx9LjLR/a4WhTazl2htSKYDBX1wg3pOhUhYM12tRajvCS4SBWxvQqmVqOrCERwVxNo7shVup6MiTCVC9H95KxUtdjiDeYkjcVN5k4igzRRCJAfkXjdEOkjEnX97MN0TiKQCKC6a1RcilElqqS0YKx+iEsNfpNWtTclWRIjoNYyBhcT7s9Yz8U0twRIHWqaWEEwZKQOlyc773yS80hGkUG8+ZPMgo77kP7z4OhRaQgpdNfAsEM4kZxDc3UFg7MRo2Pxuw+0HiCsT7qoIYEYu0sNw/Xs4KRMoSvp/GZhmiu8tqXdhjTHu8ZfKxmrmWqlWV4juCa0tuMl7CYIZqr3t31Bi6VHGZIC0dOO8d3MEQaLH3Ws0pHA/L8r613BscbUkzQNAuqwVYAAAAASUVORK5CYII=";
        let d4 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAVCAYAAAD/wUjgAAAAAXNSR0IArs4c6QAAAWdJREFUWEftWMENgzAMhGlggi7RebtEJ4BpWgXVlXHj2NiHUBG8Kpo45zvniNN3wGcYbq8t4eb52W8Z7x2bwfEFlAlSgJb50/TwYl7GjeO9k6QcjWMhJJtMZD4xx0mJxMnOlzj6CAgZ5Ewx4IQUxcqjbR/5PymMJjWKY0VINAhP5t9jwAnZ5KrMWNGkRnHAt0wUCHrLRHFchHyYIy+7CNmbEISpRssd4UNwU0UQcmQMOCFHqosw5tN5SOtQ2BILaqpWP8S3AP0mcNTcIdSlmNQgltMyX691eiYckObOAlIWo4RrHS6fj+iYuUCy+aMK4kTxjvun/ZesElj5XrvL0BLn72V18FLW1M3g4OtZwqwuaDzJWJc6WuJyS3gqRY6xkpHE8mqTTaRZIbLMNFZb6ta8hAORpuapsgyO2nqWMNUKoUBaa26p601cc30NtJWM55Nfu5Gregipq7GaTdIDVpozn0PGvDeONyPM6DT/LIOKAAAAAElFTkSuQmCC";
        let d5 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAVCAYAAAD/wUjgAAAAAXNSR0IArs4c6QAAAYNJREFUWEfdmNENgzAMRGEamKBLdN4u0QlgmlZBcmWOODbOVajtVwWJeT47TpxxIP6m6fY6Y25dn+OZ8dGxPRwfoB4jBbTMX5ZHlHkbN8/3AUW5mmMTpNeZzHxRTouSsdM7HznGDAQa+ScbdEFKxMrPWj74XiLMFjXLsRMka0Q78+s26IKcqqqqsLJFzXLQlwyCRDKm7DTsJZPlaIIwnPk1G18XxEvdSFFliBrloKdqBF7vQhFBos4w6hC9qDIEudIGXRAvmrVih0WVIUiWg75ksiCsXaZ1KGyxydKlCOL1Qzri8l/gpLljCCI2pUEsp2X9vdbpWTgozZ0HopdErcPV8xkdsw4QNn+SQVoo3XEf2n9UVWDxuXWXIZFGx/VzzA6dylZ0ezj09yw+GbO7oIk4413qWI7jkohkSkvUKIfVmbsZgmlmqdqKbq2W6HMGFrVIlvVw1L7nBaaaIZaq+LxWtWs3Xl400Y4F7TkT2eE8voMglqrR6EagvDEWtOeMZzfy/g31PQBDlNE1ZwAAAABJRU5ErkJggg==";
        let d6 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAVCAYAAAD/wUjgAAAAAXNSR0IArs4c6QAAAWRJREFUWEftWNERgzAI1Wl0gi7RebuEE+g07cUrPXwNAQGvV0+/PE3I4wEvIX2X+AzD7bnH3LJM/Z7x1rERHB9AESMFaJk/zw8r5nXcON47JOXXOFZCos545hNznBSPneh8xNF7QKCRM9lIJ6RErDxS+eB/inA2qV4cG0K8Rrgz/24jnZBdqsqENZtUL46rZN47I5VueoZcJbNMp8qyUzmToUNXyRytIV51z4huxlkmvWQyCInYaB0KW3aru4wXiNYP8Z2H3mktau4yoks2qUEsp2W+Xuv0TDhSmjsNSFmMHK51uHx+RsfMA4TNH2UQJ4p33F/tP7JKYPG7dJchOc6/Y3bwzJSiG8HB19MCs7mgsTijXepIjmNJWDIFx2jOILE827CJVDME00xitRXdmpZwIKhRliyL4KitpwWmmiHafYcWXavjkohLoDVnLJtC7UauqiEUXYnVqJMWsCjOfA4J89E4Xsa9GEM9XNSmAAAAAElFTkSuQmCC";
        loadSheet(this, "d1", d1, 17, 21);
        loadSheet(this, "d2", d2, 17, 21);
        loadSheet(this, "d3", d3, 17, 21);
        loadSheet(this, "d4", d4, 17, 21);
        loadSheet(this, "d5", d5, 17, 21);
        loadSheet(this, "d6", d6, 17, 21);

        let roll = "data:image/png;base64,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"
        loadSheet(this, "roll", roll, 48, 48);

       // this.load.spritesheet("roll", "/diceRollAnim.png", {frameWidth: 48, frameHeight: 48});

        let bullet = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACJJREFUKFNjXKWn+p8BD2AEKfASFcSqZNvr9wxDRwE+bwIApJMh6Z8kSoUAAAAASUVORK5CYII=";    
        this.textures.addBase64("bullet", bullet);

        let dungeon = "data:image/png;base64,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"
        this.textures.addBase64("background", dungeon);

        let slime = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAALiMAAC4jAHM9rsvAAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAAv0lEQVR42u3csQ2CUBSGUdiA2i1oNE7BFCaM5BpOQekW1m4g1UseeU8gge6er7zlyV/f9va4/hr9rQW0E6jrLzSyvu9PCZSO0cstCqDoS0oGq0BRl1QzAHQEaBjvIWBezwkQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBMhrCkCnAEVuE0grD5a0XNICSPUAbTQD+sE9TR5Vo5gAAAAASUVORK5CYII=";
        this.textures.addBase64("slime", slime);

        let clone = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAALiMAAC4jAHM9rsvAAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAAwElEQVR42u3coQ2DUBSGUZijg7ABHls0IyBRlYxQXc1cTPFQJBD6gKR193zyypNf3/JZV6lQthLQTaDUDDS2MNPrCLQeo7e1OABFX9JqcAoUdUnfDAD9AvR5jyFg2q4HBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAHymgLQX4AidwmkkwdL2i9pB6QMFKB8c3oUC7ZZQLg1rcTQAAAAAElFTkSuQmCC";
        this.textures.addBase64("clone", clone);

        let explosion = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAALiMAAC4jAHM9rsvAAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAAuklEQVR42u3csQ3CMBCGUbwKPSUTBBYwc5IJ2ICSnlWgiuTIjo0UuntfeeXTX1+arvlz0GYJ0I9A8/lEoyg/XzXQcoxeaVEBRV/SYtAFirqklgGgPUC3yzEEzP3xBgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAAB8poC0F+AIjcEUufBktZLWgGpHaBBXyC5P41NBz70AAAAAElFTkSuQmCC";
        this.textures.addBase64("explosion", explosion);

        let fire = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAALiMAAC4jAHM9rsvAAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAAvUlEQVR42u3cMQ6CQBCGUaAy3Mfe0ooDeQAO5Am8DhcwVkq1yZJdgQS6eV855ctfTztd779Gf2sB7QS6jDcaWZ/HqwRKx+jlFgVQ9CUlg1WgqEuqGQA6AjR0fQiY5/cNCBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQLkNQWgU4AitwmklQdLWi5pAaR6gDaaATrIZu2nRz9cAAAAAElFTkSuQmCC";
        this.textures.addBase64("fire", fire);

        let lava = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAALiMAAC4jAHM9rsvAAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAAs0lEQVR42u3csRFAQBCGUTIVSHRAA/rvQQkSFciIzDDOnRmyfV+44Zs/3rrvx63SYzWgl0BTA+PcsCaAjmP0zhY3oOhLOgyyQFGXlDIA9AWo69oQMPO8AAIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAeU0B6BegyBWBlAHSdUkXIKUDVGgHxiwljrprCRQAAAAASUVORK5CYII=";
        this.textures.addBase64("lava", lava);



    }


    function create() {
        keys = this.input.keyboard.createCursorKeys();
        spacebar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
        idleAnim = this.anims.create({
            key: 'idle',
            frames: this.anims.generateFrameNumbers('idle', {start: 0, end: 3}),
            frameRate: 4,
            repeat: -1
        });

        runAnim = this.anims.create({
            key: 'run',
            frames: this.anims.generateFrameNumbers('run', {start: 0, end: 6}),
            frameRate: 14,
            repeat: -1
        });

        daveIdle = this.anims.create({
            key: 'dave_idle',
            frames: this.anims.generateFrameNumbers('dave_idle', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });

        d1Run = this.anims.create({
            key: 'd1_run',
            frames: this.anims.generateFrameNumbers('d1', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });

        d6Run = this.anims.create({
            key: 'd6_run',
            frames: this.anims.generateFrameNumbers('d6', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });

        d2Run = this.anims.create({
            key: 'd2_run',
            frames: this.anims.generateFrameNumbers('d2', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });

        d3Run = this.anims.create({
            key: 'd3_run',
            frames: this.anims.generateFrameNumbers('d3', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });

        d4Run = this.anims.create({
            key: 'd4_run',
            frames: this.anims.generateFrameNumbers('d4', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });

        d5Run = this.anims.create({
            key: 'd5_run',
            frames: this.anims.generateFrameNumbers('d5', {start: 0, end: 3}),
            frameRate: 8,
            repeat: -1
        });

        diceRoll = this.anims.create({
            key: 'roll',
            frames: this.anims.generateFrameNumbers('roll', {start: 0, end: 6}),
            frameRate: 14,
            repeat: -1
        });


        //createDave(this, 200, 200);

        background = this.matter.add.sprite(400, 400, 'background');
        background.setScale(2.6);
        background.setSensor(true);
        background.alpha = 0.5;

        player = this.matter.add.sprite(400, 600, 'run');
        player.canDash = true;
        player.dashing = false;
        player.setScale(2);
        player.isMoving = {x: false, y: false};
        player.setFixedRotation();
        player.setMass(1);
        player.body.name = "player";

        arrow = this.matter.add.sprite(400, 550, 'arrow');
        arrow.setScale(2);
        arrow.setSensor(true);

        dice = this.matter.add.sprite(400, 100, "dice");
        dice.fiery = false;
        dice.rotateNum = 0;
        dice.colors = ['slime', 'lava', 'explosion', 'clone', 'dice', 'dice', 'fire'];
        dice.setRotation(Math.PI/4);
        dice.setMass(100000);
        dice.setFriction(0);
        dice.setFrictionAir(FRICTION);
        dice.setBounce(BOUNCE);
        dice.tintFill = true;
        dice.clearTint();
        dice.elapsed = 0;
        dice.body.name = "dice";
        dice.detector = this.matter.add.sprite(400, 400, "dice");
        dice.detector.name = "detector";
        dice.detector.setScale(2.5);
        dice.detector.visible = false;
        dice.detector.setSensor(true);

        for (var x = 0; x < 10; x++){
            hoverableRollAnim = this.matter.add.sprite(0, 0, "roll");
            hoverableRollAnim.play("roll", true);
            hoverableRollAnim.setSensor(true);
            hoverableRollAnim.visible = false;
            hoverableRollAnims.push(hoverableRollAnim);
        }

        /*
        enmie = this.matter.add.sprite(300, 100, "dice");
        enmie.setScale(0.9, 0.9);
        enmie.setRotation(Math.PI/4);
        enmie.setMass(100000);
        enmie.setAngularVelocity(2);
        enmie.setFriction(0);
        enmie.setBounce(1);
        enmie.setVelocity(10,10)
        enmie.tintFill = true;
        enmie.clearTint();
        enmie.body.name = "dice";
*/

        //create edges of playing area
        var rightEdge = this.matter.add.rectangle(800, 0, 100, 1600, {isStatic: true});
        rightEdge.name = "rightWall";
        var leftEdge = this.matter.add.rectangle(0, 0, 100, 1600, {isStatic: true});
        leftEdge.name = "leftWall";
        var upEdge = this.matter.add.rectangle(0, 0, 2000, 100, {isStatic: true});
        upEdge.name = "upWall";
        var downEdge = this.matter.add.rectangle(0, 800, 2000, 100, {isStatic: true});
        downEdge.name = "downWall";


        //collision events

        //player kick
        dice.detector.setOnCollideActive((data)=>{
            if (wasInvolved(player, data)){
                player.canDash = false;
            }
            var self = this;
            if (keys.space.isDown && interactable && wasInvolved(player, data) && kickCount > 0){
               // console.log("HI!");
                if (dice.num == 1) {
                    dice.slimeAnim = setInterval(function() {
                        createSlime(self, dice.body.position.x, dice.body.position.y);
                    }, 100);
                } else if (dice.num == 2) {
                   // console.log("HI2!");
                    dice.lavaAnim = setInterval(function() { 
                        createLava(self, dice.body.position.x, dice.body.position.y);
                    }, 2000);
                } else if (dice.num == 3) {
                    dice.rotateNum = 0;
                    dice.flashAnim = setInterval(function() {
                        if (dice.rotateNum == 0){
                            dice.rotateNum = 1;
                            dice.setTintFill("0xFFFFFF");
                        }
                        else{
                            dice.rotateNum =  0;
                            dice.clearTint();
                        }
                    }, 200);
                    
                    setTimeout(function(){
                        createExplosion(self, dice.body.position.x, dice.body.position.y);
                        clearInterval(dice.flashAnim);
                        dice.clearTint();
                    }, 2000);
                }

                var newVelocity = getForceVector(player.body.position, dice.body.position, FORCE);
               // console.log(newVelocity);
                dice.setVelocity(newVelocity.x, newVelocity.y);

                dice.state = "action";
                dice.loadedState = false;
                dice.setAngularVelocity(0.2);
                //dice.setTintFill(0xECA72C);
                interactable = false;
                if (stage == "tutorialPt2" && !stageCompleted){
                    stageTransition("tutorialPt3", this);
                }

                updateKickAndEnemyCounts(kickCount - 1, enemyCount);
                
            }
        });

        dice.detector.setOnCollideEnd((data)=>{
            if (wasInvolved(player, data)){
                player.canDash = true;
            }
        });

        dice.setOnCollideWith(player, (data)=>{
            if (dice.fiery){
                player.visible = false;
                isAlive = false;
            }
        }); 

        // enmie.detector.setOnCollideActive((data)=>{
        //     if (keys.space.isDown && interactable && wasInvolved(player, data) && kickCount > 0){
        //         var newVelocity = getForceVector(player.body.position, enmie.body.position, FORCE);
        //         console.log(newVelocity);
        //         enmie.setVelocity(newVelocity.x, newVelocity.y);
        //         console.log("DID IT");
        //         enmie.setAngularVelocity(0.2);  
        //         enmie.setTintFill(red);
        //         interactable = false;
        //         if (stage == "tutorialPt2" && !stageCompleted){
        //             stageTransition("tutorialPt3", this);
        //         }

        //         updateKickAndEnemyCounts(kickCount - 1, enemyCount);
                
        //     }
        // });
        dice.state = "selecting";
        dice.loadedState = false;

        var self = this;
        dice.activate = function(){
            let num = Math.floor(Math.random() * 3) + 1;
            dice.num = num;
            dice.setTexture(dice.colors[num - 1]);
            dice.loadedState = true;
            interactable = true;
            switch(num){
                case 1:
                    break;
                case 2:
                    break;
                case 3:
                    
                    break;
                case 4:
                   
                    break;
                case 5:
                    dice.setScale(2.5);
                    dice.detector.setScale(3.125);
                    break;
                case 6:
                    break;
            }
            var text = self.add.text(dice.body.position.x, dice.body.position.y, num);
            
            setTimeout(function(){
                text.destroy();
            }, 2000);
        }
       /* dice.setOnCollideWith(rightEdge, (data)=>{
            if (!interactable){
                dice.activate();
            }
        });

        dice.setOnCollideWith(leftEdge, (data)=>{
            if (!interactable){
                dice.activate();
            }
        });

        dice.setOnCollideWith(upEdge, (data)=>{
            if (!interactable){
                dice.activate();
            }
        });

        dice.setOnCollideWith(downEdge, (data)=>{
            if (!interactable){
                dice.activate();
            }
        });*/




    }

    function update() {

        //player movement stuff
        if (isAlive) {
            if (enemyCount <= 0 && kickCount >= 0){
                if (stage == "one"){
                    loadStage("two", this);
                }
            }
            if(player.inSlime) {
                SPEED = 1;
            } else {
                SPEED = 3;
            }

            if(player.inLava) {
                player.isAlive = false;
                player.visible = false;
            }

            if(player.dashing) {
                player.isMoving.x = true;
            } else {
                if (keys.left.isDown){
                    player.setVelocityX(-SPEED);
                    player.setFlipX(true);
                    player.isMoving.x = true;
                }
                else if (keys.right.isDown){
                    player.setVelocityX(SPEED);
                    player.setFlipX(false);
                    player.isMoving.x = true;
                }
                else{
                    player.isMoving.x = false;
                    player.setVelocityX(0);
                }

                if (keys.up.isDown){
                    player.setVelocityY(-SPEED);
                    player.isMoving.y = true;
                }
                else if (keys.down.isDown){
                    player.setVelocityY(SPEED);
                    player.isMoving.y = true;
                }
                else{
                    player.isMoving.y = false;
                    player.setVelocityY(0);
                }
            }

            

            if (!player.isMoving.x && !player.isMoving.y){
                player.play('idle', true);
                player.setVelocityX(0);
                player.setVelocityY(0);
            }
            else{
                player.play("run", true);
                if (stage == "tutorialPt1" && !stageCompleted){
                    stageTransition("tutorialPt2", this, 500);
                }
            }

            if (keys.space.isDown && stage == "tutorialPt3" && !stageCompleted){
                stageCompleted = true;
                stageTransition("one", this);
            }

            if (Phaser.Input.Keyboard.JustDown(spacebar) && player.canDash){
                player.setVelocity(player.body.velocity.x * 3, player.body.velocity.y * 3);
                player.dashing = true;
                player.canDash = false;
                setTimeout(function(){
                    player.dashing =  false;
                    player.setVelocity(0, 0);
                    player.canDash = true;
                }, 150); 
            }
            

        // player.play("run");
        }
        
        let speed = Math.sqrt(Math.pow(dice.body.velocity.x, 2) + Math.pow(dice.body.velocity.y, 2))
            
        //max speed of 10
        if (speed > 10 && !dice.fiery){
            dice.setVelocityX((dice.body.velocity.x/speed) * 10);
            dice.setVelocityY((dice.body.velocity.y/speed) * 10);
        }
        else if (speed > 15){
            dice.setVelocityX((dice.body.velocity.x/speed) * 15);
            dice.setVelocityY((dice.body.velocity.y/speed) * 15);
        }

        dice.detector.setPosition(dice.body.position.x, dice.body.position.y);
        
        
        //make dice usable when slow enough
        if (speed < 1.5 && dice.state != "selecting" && dice.state != "selected"){
            resetDice();
            dice.state = "selecting";
            dice.loadedState = false;
            interactable = false;
           
        } 

        for (dave of daves){
            if (dave != 0){
                dave.update();
            }
        }

        for (bob of bobs){
            if (bob != 0){
                bob.update();
            }
        }

       /* speed = Math.sqrt(Math.pow(enmie.body.velocity.x, 2) + Math.pow(enmie.body.velocity.y, 2))

        if (speed > 14.14)
        {
            enmie.setVelocity(enmie.body.velocity.x / 1.1, enmie.body.velocity.y / 1.1)
        }
        else if (speed < 7.05)
        {
            enmie.setVelocity(enmie.body.velocity.x * 1.1, enmie.body.velocity.y * 1.1)
        }*/

        //enmie.body.setMaxSpeed(14.14);

        var newArrowPos = getForceVector(player.body.position, dice.body.position, 50);
        arrow.setPosition(player.body.position.x + newArrowPos.x, player.body.position.y + newArrowPos.y);
        let offset = -Math.PI/2;
        if (dice.body.position.x > player.body.position.x){
            offset = Math.PI/2
        }
        arrow.setRotation(Math.atan((dice.body.position.y - player.body.position.y)/(dice.body.position.x - player.body.position.x)) + offset);
    
        //enmie.setAngularVelocity(1);
        
        if (dice.state == "selecting" && !dice.loadedState){
            dice.loadedState = true;
            dice.setStatic(true);
            //dice.setTintFill(dice.colors[dice.rotateNum]);
            dice.selectionAnim = window.setInterval(function(){
                dice.rotateNum += 1;
                if (dice.rotateNum > 5){
                    dice.rotateNum = 0;
                }
                dice.setTexture(dice.colors[dice.rotateNum]);
            }, 200);

            window.setTimeout(function(){
                dice.state = "selected";
                dice.loadedState = false;
                window.clearInterval(dice.selectionAnim);
            }, 1000);
        }
        else if (dice.state == "selecting"){
            dice.setRotation(dice.rotation + 5);
        }
        else if (dice.state == "selected" && !dice.loadedState){
            dice.setStatic(false);
            dice.loadedState = true;
            dice.activate();
        }
        else if (dice.state == "action" && dice.fiery){
            dice.setTexture('fire');
        }

    }

    
    </script>

</body>
</html>